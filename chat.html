<!DOCTYPE html>
<html lang="ru">
<head>
<meta charset="UTF-8">
<title>–ß–∞—Ç-–∑–∞–º–µ—Ç–∫–∏</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<style>
* { box-sizing: border-box; margin:0; padding:0; }

body, html {
    height: 100%;
    font-family: Arial, sans-serif;
    background: #f2f2f2;
    overflow: hidden;
    transition: background 0.3s;
}

.chat-wrapper {
    display: flex;
    flex-direction: column;
    height: 100%;
    max-width: 500px;
    margin: 0 auto;
    background: white;
    border-radius: 10px;
    box-shadow: 0 4px 10px rgba(0,0,0,0.1);
    overflow: hidden;
    transition: background 0.3s;
}

.chat-title {
    font-size: 28px;
    font-weight: bold;
    color: #4CAF50;
    text-align: center;
    padding: 15px;
    text-shadow: 1px 1px 2px rgba(0,0,0,0.2);
    flex-shrink: 0;
    position: relative;
}

#themeToggle {
    position: absolute;
    top: 10px;
    right: 10px;
    padding: 5px 10px;
    cursor: pointer;
    border: none;
    border-radius: 5px;
    background: #4CAF50;
    color: white;
    font-size: 14px;
}

#themeToggle:hover { background: #45a049; }

.chat-box {
    flex: 1;
    overflow-y: auto;
    padding: 10px;
    transition: background 0.3s;
}

.message {
    background: #e3e3ff;
    padding: 8px 12px;
    border-radius: 15px;
    margin-bottom: 8px;
    max-width: 75%;
    word-break: break-word;
    transition: background 0.3s, color 0.3s;
}

.message-text div {
    white-space: pre-wrap; /* —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–µ—Ä–µ–Ω–æ—Å—ã —Å—Ç—Ä–æ–∫ –∏–∑ —Ç–µ–∫—Å—Ç–∞ */
}


.message-time {
    font-size: 11px;
    color: #666;
    text-align: right;
    margin-top: 4px;
    transition: color 0.3s;
}

.edit-btn {
    font-size: 12px;
    background: none;
    border: none;
    cursor: pointer;
    color: #555;
    margin-top: 4px;
    transition: color 0.3s;
}

.edit-btn:hover { color: black; }

.input-area-wrapper {
    padding: 10px;
    background: #fff;
    flex-shrink: 0;
    border-top: 1px solid #ddd;
    transition: background 0.3s, border-color 0.3s;
}

.input-area {
    display: flex;
    gap: 10px;
}

input {
    flex: 1;
    padding: 10px;
    border-radius: 5px;
    border: 1px solid #ccc;
    font-size: 16px;
    transition: background 0.3s, color 0.3s, border-color 0.3s;
}

button {
    padding: 10px 15px;
    border: none;
    border-radius: 5px;
    background: #4CAF50;
    color: white;
    cursor: pointer;
    transition: background 0.3s;
}

button:hover { background: #45a049; }

.reply-text {
    font-size: 12px;
    color: #555;
    border-left: 2px solid #aaa;
    padding-left: 6px;
    margin-bottom: 4px;
    cursor: pointer;
    transition: color 0.3s, border-color 0.3s;
}

.reply-preview {
    display: none;
    background:#f0f0f0;
    padding:5px 8px;
    border-left:3px solid #4CAF50;
    margin-bottom:5px;
    border-radius:5px;
    font-size:13px;
    position:relative;
    transition: background 0.3s, border-color 0.3s;
}

.reply-preview #cancelReply {
    position:absolute;
    right:5px;
    cursor:pointer;
}

/* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ */
body.dark, .dark .chat-wrapper {
    background: #1e1e1e;
    color: #ddd;
}

.dark .chat-box { background: #2c2c2c; }
.dark .message { background: #3a3a3a; color: #ddd; }
.dark .message-time { color: #aaa; }
.dark .edit-btn { color: #ccc; }
.dark .edit-btn:hover { color: white; }
.dark .input-area-wrapper { background: #2c2c2c; border-top: 1px solid #555; }
.dark input { background: #3a3a3a; color: #ddd; border: 1px solid #555; }
.dark button { background: #4CAF50; color: white; }
.dark .reply-text { color: #ccc; border-color: #777; }
.dark .reply-preview { background:#3a3a3a; border-color:#4CAF50; color: #ddd; }
/* –¢—ë–º–Ω–∞—è —Ç–µ–º–∞ –¥–ª—è –∫–Ω–æ–ø–æ–∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∏ –æ—Ç–≤–µ—Ç–∞ */
.dark .edit-btn {
    color: #aaa;           /* —Å–≤–µ—Ç–ª–æ-—Å–µ—Ä—ã–π —Ç–µ–∫—Å—Ç –≤–º–µ—Å—Ç–æ –∑–µ–ª–µ–Ω–æ–≥–æ */
    background: none;      /* —É–±–∏—Ä–∞–µ–º —Ñ–æ–Ω */
    padding: 2px 5px;      /* –¥–µ–ª–∞–µ–º –∏—Ö –∫–æ–º–ø–∞–∫—Ç–Ω–µ–µ */
    font-size: 12px;       /* —Ñ–∏–∫—Å–∏—Ä—É–µ–º —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ */
}

.dark .edit-btn:hover {
    color: #fff;           /* –ø–æ–¥—Å–≤–µ—Ç–∫–∞ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ */
    background: rgba(255, 255, 255, 0.1); /* –ª—ë–≥–∫–∏–π —Ñ–æ–Ω –ø—Ä–∏ —Ö–æ–≤–µ—Ä–µ */
}


</style>
</head>
<body>

<div class="chat-wrapper">
    <div class="chat-title">–ß–∞—Ç-–∑–∞–º–µ—Ç–∫–∏</div>
	<button id="themeToggle">üåô</button>
    <div class="chat-box" id="chatBox"></div>

    <div class="input-area-wrapper">
        <div class="reply-preview" id="replyPreview">
            <span id="replyText"></span>
            <span id="cancelReply">‚ùå</span>
        </div>
        <div class="input-area">
            <input type="text" id="messageInput" placeholder="–í–≤–µ–¥–∏—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏–µ...">
            <button onclick="sendMessage()">–û—Ç–ø—Ä–∞–≤–∏—Ç—å</button>
            <button onclick="copyChat()">üíæ</button>
        </div>
    </div>
</div>

<script>
function getCurrentTime() {
    const now = new Date();
    return now.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
}

function sendMessage() {
    const input = document.getElementById("messageInput");
    const chatBox = document.getElementById("chatBox");
    const text = input.value.trim();
    if (!text) return;

    const replyPreview = document.getElementById("replyPreview");
    replyPreview.style.display = "none";
    let replyText = "";
    if (input.dataset.replyTo) {
        replyText = input.dataset.replyTo;
        delete input.dataset.replyTo;
    }

    const message = document.createElement("div");
    message.className = "message";

    const textDiv = document.createElement("div");
    textDiv.className = "message-text";

	if (replyText) {
		const replyDiv = document.createElement("div");
		replyDiv.className = "reply-text";

		// –æ–±—Ä–µ–∑–∞–µ–º —Ç–µ–∫—Å—Ç –¥–æ 50 —Å–∏–º–≤–æ–ª–æ–≤
		const shortReply = replyText.length > 50 ? replyText.slice(0, 50) + "..." : replyText;
		replyDiv.textContent = "–û—Ç–≤–µ—Ç –Ω–∞: " + shortReply;

		// —Å–∫—Ä–æ–ª–ª –∫ —Å–æ–æ–±—â–µ–Ω–∏—é –ø—Ä–∏ –∫–ª–∏–∫–µ
		replyDiv.onclick = function () {
			const messages = Array.from(document.querySelectorAll(".message"));
			for (const msg of messages) {
				const mainTextDiv = msg.querySelector(".message-text div:last-child");
				if (mainTextDiv && mainTextDiv.textContent === replyText) {
					msg.scrollIntoView({ behavior: "smooth", block: "center" });
					msg.style.background = "#d0f0d0";
					setTimeout(() => msg.style.background = "#e3e3ff", 1000);
					break;
				}
			}
		};

		textDiv.appendChild(replyDiv);
	}

    const mainText = document.createElement("div");
    mainText.textContent = text;
    textDiv.appendChild(mainText);

    const timeDiv = document.createElement("div");
    timeDiv.className = "message-time";
    timeDiv.textContent = getCurrentTime();

    const editBtn = document.createElement("button");
    editBtn.className = "edit-btn";
    editBtn.textContent = "‚úèÔ∏è –†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å";
    editBtn.onclick = function () { editMessage(message); };

    const replyBtn = document.createElement("button");
    replyBtn.className = "edit-btn";
    replyBtn.textContent = "üí¨ –û—Ç–≤–µ—Ç–∏—Ç—å";
    replyBtn.onclick = function () {
        const inputField = document.getElementById("messageInput");
        const preview = document.getElementById("replyPreview");
        const previewText = document.getElementById("replyText");

        inputField.focus();
        inputField.dataset.replyTo = mainText.textContent;

        previewText.textContent = mainText.textContent.length > 50 
            ? mainText.textContent.slice(0, 20) + "..." 
            : mainText.textContent;
        preview.style.display = "block";
    };

    message.appendChild(textDiv);
    message.appendChild(timeDiv);
    message.appendChild(editBtn);
    message.appendChild(replyBtn);

    chatBox.appendChild(message);

    input.value = "";
    chatBox.scrollTop = chatBox.scrollHeight;
}

function editMessage(messageContainer) {
    const textDiv = messageContainer.querySelector(".message-text");
    const mainText = textDiv.querySelector("div:last-child").textContent;

    const textarea = document.createElement("textarea");
    textarea.value = mainText;
    textarea.style.width = "100%";

    const saveBtn = document.createElement("button");
    saveBtn.textContent = "–°–æ—Ö—Ä–∞–Ω–∏—Ç—å";
    saveBtn.style.marginTop = "5px";

    const replyDiv = textDiv.querySelector(".reply-text");
    if (replyDiv) replyDiv.remove();
    textDiv.replaceWith(textarea);
    messageContainer.appendChild(saveBtn);

    saveBtn.onclick = function () {
        const newTextDiv = document.createElement("div");
        newTextDiv.className = "message-text";

        if (replyDiv) newTextDiv.appendChild(replyDiv);

        const mainTextDiv = document.createElement("div");
        mainTextDiv.textContent = textarea.value;
        newTextDiv.appendChild(mainTextDiv);

        textarea.replaceWith(newTextDiv);
        saveBtn.remove();
    };
}

document.getElementById("cancelReply").onclick = function () {
    const inputField = document.getElementById("messageInput");
    const replyPreview = document.getElementById("replyPreview");
    delete inputField.dataset.replyTo;
    replyPreview.style.display = "none";
};

document.getElementById("messageInput").addEventListener("keydown", function(e){
    if(e.key === "Enter") sendMessage();
});

function copyChat() {
    const chatBox = document.getElementById("chatBox");
    let chatText = "";

    chatBox.querySelectorAll(".message").forEach(msg => {
        let mainText = "";
        const textDiv = msg.querySelector(".message-text");
        if (!textDiv) return;

        const textarea = msg.querySelector("textarea");

        if (textarea) {
            mainText = textarea.value;
        } else {
            const mainDiv = textDiv.querySelector("div:last-child");
            mainText = mainDiv ? mainDiv.innerText : "";
        }

        // === –¶–ò–¢–ê–¢–ê ===
        const replyDiv = msg.querySelector(".reply-text");
        const replyText = replyDiv ? replyDiv.innerText : "";

        // === –í–†–ï–ú–Ø ===
        const timeDiv = msg.querySelector(".message-time");
        const time = timeDiv ? " `" + timeDiv.textContent + "`" : "";

        // –î–æ–±–∞–≤–ª—è–µ–º —Ü–∏—Ç–∞—Ç—É (>>)
        if (replyText) {
            replyText.split("\n").forEach(line => {
                chatText += ">>" + line + "\n";
            });
        }

        // === –û—Å–Ω–æ–≤–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ (>) ===
        const mainLines = mainText.split("\n");

        mainLines.forEach((line, index) => {
            if (index === mainLines.length - 1) {
                chatText += ">" + line + time + "\n";
            } else {
                chatText += ">" + line + "\n";
            }
        });

        chatText += "\n";
    });

    navigator.clipboard.writeText(chatText)
        .then(() => alert("–ß–∞—Ç —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω –≤ –±—É—Ñ–µ—Ä –æ–±–º–µ–Ω–∞!"))
        .catch(err => alert("–û—à–∏–±–∫–∞ –ø—Ä–∏ –∫–æ–ø–∏—Ä–æ–≤–∞–Ω–∏–∏: " + err));
}




// –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ç–µ–º—ã
const themeBtn = document.getElementById('themeToggle');
themeBtn.onclick = () => {
    document.body.classList.toggle('dark');
    themeBtn.textContent = document.body.classList.contains('dark') ? '‚òÄÔ∏è' : 'üåô';
};



</script>

</body>
</html>
